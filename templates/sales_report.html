{% extends "base.html" %}

{% block title %}Sales Reports{% endblock %}

{% block styles %}
<!-- Add any page-specific CSS here -->

{% endblock %}

{% block content %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        :root {
            --content-bg: #ffffff;
            --bg-color: #f5f5f7;
            --text-color: #333;
            --subtext-color: #666;
            --border-color: #e1e1e1;
            --hover-color: #f0f0f0;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode {
            --content-bg: #1e1e2d;
            --bg-color: #151521;
            --text-color: #e0e0e0;
            --subtext-color: #aaa;
            --border-color: #2c2c40;
            --hover-color: #2a2a3a;
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
        }

        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .page-header h1 {
            font-size: 24px;
            margin: 0;
        }

        .filter-card {
            background-color: var(--content-bg);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--card-shadow);
        }

        .filter-form {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: flex-end;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: var(--text-color);
        }

        .filter-input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--bg-color);
            color: var(--text-color);
        }

        .filter-button {
            padding: 10px 15px;
            background-color: #4a86f7;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            height: 40px;
        }

        .filter-button:hover {
            background-color: #3a76e7;
        }

        .export-button {
            padding: 10px 15px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-button:hover {
            background-color: #27ae60;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            grid-gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background-color: var(--content-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--card-shadow);
            position: relative;
        }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .stat-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 18px;
        }

        .sales-icon {
            background-color: rgba(231, 76, 60, 0.15);
            color: #e74c3c;
        }

        .orders-icon {
            background-color: rgba(52, 152, 219, 0.15);
            color: #3498db;
        }

        .avg-icon {
            background-color: rgba(241, 196, 15, 0.15);
            color: #f1c40f;
        }

        .revenue-icon {
            background-color: rgba(46, 204, 113, 0.15);
            color: #2ecc71;
        }

        .stat-title {
            color: var(--subtext-color);
            font-size: 14px;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--text-color);
        }

        .stat-change {
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
            margin-top: 5px;
        }

        .positive-change {
            color: #2ecc71;
        }

        .negative-change {
            color: #e74c3c;
        }

        .charts-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-gap: 20px;
            margin-bottom: 20px;
        }

        @media (max-width: 900px) {
            .charts-grid {
                grid-template-columns: 1fr;
            }
        }

        .chart-card {
            background-color: var(--content-bg);
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--card-shadow);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .chart-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }

        .chart-legend {
            display: flex;
            gap: 15px;
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: var(--subtext-color);
        }

        .legend-color {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .top-products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .top-products-table th,
        .top-products-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .top-products-table th {
            background-color: var(--bg-color);
            font-weight: 600;
            color: var(--text-color);
        }

        .product-name {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .product-image {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            background-color: var(--bg-color);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-progress {
            height: 6px;
            background-color: var(--bg-color);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 5px;
        }

        .product-progress-bar {
            height: 100%;
            background-color: #4a86f7;
        }

        /* Dropdown Styles */
        .dropdown {
            position: relative;
            display: inline-block;
        }

        .dropdown-button {
            background-color: var(--bg-color);
            color: var(--text-color);
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            right: 0;
            background-color: var(--content-bg);
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
            z-index: 1;
            border-radius: 8px;
            overflow: hidden;
        }

        .dropdown-item {
            padding: 10px 15px;
            text-decoration: none;
            display: block;
            color: var(--text-color);
            cursor: pointer;
        }

        .dropdown-item:hover {
            background-color: var(--hover-color);
        }

        .dropdown:hover .dropdown-content {
            display: block;
        }

        /* Export Modal Styles */
        .export-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .export-option {
            flex: 1;
            background-color: var(--bg-color);
            border-radius: 8px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .export-option:hover {
            background-color: var(--hover-color);
        }

        .export-icon {
            font-size: 24px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: rgba(74, 134, 247, 0.1);
            color: #4a86f7;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pdf-icon {
            color: #e74c3c;
            background-color: rgba(231, 76, 60, 0.1);
        }

        .csv-icon {
            color: #2ecc71;
            background-color: rgba(46, 204, 113, 0.1);
        }

        .export-title {
            font-weight: 500;
            font-size: 16px;
            color: var(--text-color);
        }

        .export-desc {
            font-size: 12px;
            color: var(--subtext-color);
            text-align: center;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .filter-form {
                flex-direction: column;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Page Header -->
    <div class="page-header">
        <div>
            <h1>Sales Reports</h1>
            <p>Analyze your toy sales and inventory performance</p>
        </div>
        <button class="export-button" id="export-btn">
            <i class="fas fa-file-export"></i>
            Export Report
        </button>
    </div>

    <!-- Filters Section -->
    <div class="filter-card">
        <form class="filter-form" id="filter-form">
            <div class="filter-group">
                <label class="filter-label">Date Range</label>
                <select class="filter-input" id="date-range">
                    <option value="7">Last 7 days</option>
                    <option value="30" selected>Last 30 days</option>
                    <option value="90">Last 90 days</option>
                    <option value="180">Last 6 months</option>
                    <option value="365">Last year</option>
                    <option value="custom">Custom range</option>
                </select>
            </div>
            <div class="filter-group" id="start-date-group" style="display: none;">
                <label class="filter-label">Start Date</label>
                <input type="date" class="filter-input" id="start-date">
            </div>
            <div class="filter-group" id="end-date-group" style="display: none;">
                <label class="filter-label">End Date</label>
                <input type="date" class="filter-input" id="end-date">
            </div>
            <div class="filter-group">
                <label class="filter-label">Category</label>
                <select class="filter-input" id="category-filter">
                    <option value="all">All Categories</option>
                    <option value="puzzles">Puzzles</option>
                    <option value="action-figures">Action Figures</option>
                    <option value="dolls">Dolls</option>
                    <option value="board-games">Board Games</option>
                    <option value="educational">Educational Toys</option>
                </select>
            </div>
            <button type="submit" class="filter-button">
                <i class="fas fa-filter"></i>
                Apply Filters
            </button>
        </form>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon sales-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
            </div>
            <div class="stat-title">Total Sales</div>
            <div class="stat-value">2,458</div>
            <div class="stat-change positive-change">
                <i class="fas fa-arrow-up"></i>
                <span>4.5% vs. previous period</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon revenue-icon">
                    <i class="fas fa-dollar-sign"></i>
                </div>
            </div>
            <div class="stat-title">Total Revenue</div>
            <div class="stat-value">$86,420</div>
            <div class="stat-change positive-change">
                <i class="fas fa-arrow-up"></i>
                <span>12.3% vs. previous period</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon avg-icon">
                    <i class="fas fa-calculator"></i>
                </div>
            </div>
            <div class="stat-title">Avg. Order Value</div>
            <div class="stat-value">$35.15</div>
            <div class="stat-change positive-change">
                <i class="fas fa-arrow-up"></i>
                <span>2.8% vs. previous period</span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-header">
                <div class="stat-icon orders-icon">
                    <i class="fas fa-box"></i>
                </div>
            </div>
            <div class="stat-title">Units Sold</div>
            <div class="stat-value">5,937</div>
            <div class="stat-change negative-change">
                <i class="fas fa-arrow-down"></i>
                <span>1.2% vs. previous period</span>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-grid">
        <!-- Sales Trend Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Sales Trend</h3>
                <div class="dropdown">
                    <button class="dropdown-button">
                        <span>Monthly</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <div class="dropdown-item" data-period="daily">Daily</div>
                        <div class="dropdown-item" data-period="weekly">Weekly</div>
                        <div class="dropdown-item" data-period="monthly">Monthly</div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="sales-trend-chart"></canvas>
            </div>
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(74, 134, 247, 0.8);"></div>
                    <span>Sales</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: rgba(46, 204, 113, 0.8);"></div>
                    <span>Revenue</span>
                </div>
            </div>
        </div>

        <!-- Category Distribution Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Category Distribution</h3>
                <div class="dropdown">
                    <button class="dropdown-button">
                        <span>By Sales</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <div class="dropdown-item" data-metric="sales">By Sales</div>
                        <div class="dropdown-item" data-metric="revenue">By Revenue</div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="category-pie-chart"></canvas>
            </div>
        </div>

        <!-- Top Products Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Top Products</h3>
                <div class="dropdown">
                    <button class="dropdown-button">
                        <span>By Revenue</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <div class="dropdown-item" data-sort="revenue">By Revenue</div>
                        <div class="dropdown-item" data-sort="quantity">By Quantity</div>
                    </div>
                </div>
            </div>
            <table class="top-products-table">
                <thead>
                    <tr>
                        <th>Product</th>
                        <th>Sales</th>
                        <th>Revenue</th>
                        <th>% of Total</th>
                    </tr>
                </thead>
                <tbody id="top-products-body">
                    <tr>
                        <td>
                            <div class="product-name">
                                <div class="product-image">
                                    <i class="fas fa-puzzle-piece"></i>
                                </div>
                                <span>3D Puzzle Castle</span>
                            </div>
                        </td>
                        <td>452</td>
                        <td>$12,580</td>
                        <td>
                            <div>14.5%</div>
                            <div class="product-progress">
                                <div class="product-progress-bar" style="width: 85%;"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="product-name">
                                <div class="product-image">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <span>Remote Control Robot</span>
                            </div>
                        </td>
                        <td>387</td>
                        <td>$10,890</td>
                        <td>
                            <div>12.6%</div>
                            <div class="product-progress">
                                <div class="product-progress-bar" style="width: 75%;"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="product-name">
                                <div class="product-image">
                                    <i class="fas fa-chess"></i>
                                </div>
                                <span>Deluxe Chess Set</span>
                            </div>
                        </td>
                        <td>341</td>
                        <td>$8,525</td>
                        <td>
                            <div>9.8%</div>
                            <div class="product-progress">
                                <div class="product-progress-bar" style="width: 65%;"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="product-name">
                                <div class="product-image">
                                    <i class="fas fa-baby"></i>
                                </div>
                                <span>Fashion Doll Set</span>
                            </div>
                        </td>
                        <td>325</td>
                        <td>$7,800</td>
                        <td>
                            <div>9.0%</div>
                            <div class="product-progress">
                                <div class="product-progress-bar" style="width: 60%;"></div>
                            </div>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <div class="product-name">
                                <div class="product-image">
                                    <i class="fas fa-car"></i>
                                </div>
                                <span>Die-cast Racing Car</span>
                            </div>
                        </td>
                        <td>310</td>
                        <td>$6,200</td>
                        <td>
                            <div>7.2%</div>
                            <div class="product-progress">
                                <div class="product-progress-bar" style="width: 50%;"></div>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Inventory Status Chart -->
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Inventory Status</h3>
                <div class="dropdown">
                    <button class="dropdown-button">
                        <span>By Category</span>
                        <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-content">
                        <div class="dropdown-item" data-view="category">By Category</div>
                        <div class="dropdown-item" data-view="status">By Status</div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="inventory-chart"></canvas>
            </div>
            <div class="chart-legend">
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #2ecc71;"></div>
                    <span>In Stock</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #f1c40f;"></div>
                    <span>Low Stock</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background-color: #e74c3c;"></div>
                    <span>Out of Stock</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize charts
            initSalesTrendChart();
            initCategoryPieChart();
            initInventoryChart();
            
            // Handle date range selection
            const dateRangeSelect = document.getElementById('date-range');
            const startDateGroup = document.getElementById('start-date-group');
            const endDateGroup = document.getElementById('end-date-group');
            
            dateRangeSelect.addEventListener('change', function() {
                if (this.value === 'custom') {
                    startDateGroup.style.display = 'block';
                    endDateGroup.style.display = 'block';
                } else {
                    startDateGroup.style.display = 'none';
                    endDateGroup.style.display = 'none';
                }
            });
            
            // Handle filter form submission
            const filterForm = document.getElementById('filter-form');
            filterForm.addEventListener('submit', function(e) {
                e.preventDefault();
                // You would typically fetch new data here based on filters
                // For demo purposes, we'll just update the charts with new random data
                updateChartsWithNewData();
            });
            
            // Handle Export button click
            const exportBtn = document.getElementById('export-btn');
            exportBtn.addEventListener('click', function() {
                // Create export modal using your ModalCreator class
                const exportModalConfig = {
                    modalId: 'exportModal',
                    title: 'Export Report',
                    content: `
                        <div class="export-options">
                            <div class="export-option" id="export-pdf">
                                <div class="export-icon pdf-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div class="export-title">PDF Document</div>
                                <div class="export-desc">Export as a detailed PDF report with all charts and data.</div>
                            </div>
                            <div class="export-option" id="export-csv">
                                <div class="export-icon csv-icon">
                                    <i class="fas fa-file-csv"></i>
                                </div>
                                <div class="export-title">CSV Spreadsheet</div>
                                <div class="export-desc">Export raw data as CSV for further analysis.</div>
                            </div>
                        </div>
                    `
                };
                
                const exportModal = new ModalCreator(exportModalConfig);
                exportModal.open();
                
                // Add event listeners after modal is created
                setTimeout(() => {
                    document.getElementById('export-pdf').addEventListener('click', function() {
                        alert('Exporting as PDF...');
                        exportModal.close();
                    });
                    
                    document.getElementById('export-csv').addEventListener('click', function() {
                        alert('Exporting as CSV...');
                        exportModal.close();
                    });
                }, 100);
            });
            
            // Toggle dark/light mode (optional)
            const toggleThemeBtn = document.createElement('button');
            toggleThemeBtn.innerHTML = '<i class="fas fa-moon"></i>';
            toggleThemeBtn.style.position = 'fixed';
            toggleThemeBtn.style.top = '20px';
            toggleThemeBtn.style.right = '20px';
            toggleThemeBtn.style.padding = '10px';
            toggleThemeBtn.style.borderRadius = '50%';
            toggleThemeBtn.style.border = 'none';
            toggleThemeBtn.style.backgroundColor = 'var(--bg-color)';
            toggleThemeBtn.style.color = 'var(--text-color)';
            toggleThemeBtn.style.cursor = 'pointer';
            toggleThemeBtn.style.zIndex = '999';
            
            toggleThemeBtn.addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                this.innerHTML = document.body.classList.contains('dark-mode') ? 
                    '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
                updateChartsTheme();
            });
            
            document.body.appendChild(toggleThemeBtn);
            
            // Handle dropdown interactions
            setupDropdowns();
        });
        
        // Initialize Sales Trend Chart
        function initSalesTrendChart() {
            const ctx = document.getElementById('sales-trend-chart').getContext('2d');
            
            // Generate sample data
            const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
            const salesData = generateRandomData(6, 300, 500);
            const revenueData = salesData.map(sale => sale * (Math.random() * 5 + 30));
            
            window.salesTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sales',
                        data: salesData,
                        borderColor: 'rgba(74, 134, 247, 0.8)',
                        backgroundColor: 'rgba(74, 134, 247, 0.2)',
                        borderWidth: 2,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(74, 134, 247, 1)'
                    }, {
                        label: 'Revenue',
                        data: revenueData,
                        borderColor: 'rgba(46, 204, 113, 0.8)',
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderWidth: 2,
                        tension: 0.4,
                        pointBackgroundColor: 'rgba(46, 204, 113, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            callbacks: {
                                label: function(context) {
                                    let label = context.dataset.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    if (context.dataset.label === 'Revenue') {
                                        label += '$' + context.raw.toFixed(2);
                                    } else {
                                        label += context.raw.toFixed(0);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(200, 200, 200, 0.1)'
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-color')
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-color')
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize Category Pie Chart
        function initCategoryPieChart() {
            const ctx = document.getElementById('category-pie-chart').getContext('2d');
            
            window.categoryPieChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['Puzzles', 'Action Figures', 'Dolls', 'Board Games', 'Educational'],
                    datasets: [{
                        data: [25, 20, 18, 22, 15],
                        backgroundColor: [
                            'rgba(74, 134, 247, 0.8)',
                            'rgba(46, 204, 113, 0.8)',
                            'rgba(241, 196, 15, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(156, 39, 176, 0.8)'
                        ],
                        borderColor: [
                            'rgba(74, 134, 247, 1)',
                            'rgba(46, 204, 113, 1)',
                            'rgba(241, 196, 15, 1)',
                            'rgba(231, 76, 60, 1)',
                            'rgba(156, 39, 176, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                            labels: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-color'),
                                padding: 15,
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let label = context.label || '';
                                    if (label) {
                                        label += ': ';
                                    }
                                    label += context.raw + '%';
                                    return label;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Initialize Inventory Chart
        function initInventoryChart() {
            const ctx = document.getElementById('inventory-chart').getContext('2d');
            
            window.inventoryChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Puzzles', 'Action Figures', 'Dolls', 'Board Games', 'Educational'],
                    datasets: [{
                        label: 'In Stock',
                        data: [65, 45, 50, 70, 55],
                        backgroundColor: 'rgba(46, 204, 113, 0.8)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Low Stock',
                        data: [25, 30, 20, 15, 30],
                        backgroundColor: 'rgba(241, 196, 15, 0.8)',
                        borderColor: 'rgba(241, 196, 15, 1)',
                        borderWidth: 1
                    }, {
                        label: 'Out of Stock',
                        data: [10, 25, 30, 15, 15],
                        backgroundColor: 'rgba(231, 76, 60, 0.8)',
                        borderColor: 'rgba(231, 76, 60, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        x: {
                            stacked: true,
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-color')
                            }
                        },
                        y: {
                            stacked: true,
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(200, 200, 200, 0.1)'
                            },
                            ticks: {
                                color: getComputedStyle(document.body).getPropertyValue('--text-color')
                            }
                        }
                    }
                }
            });
        }
        
        // Generate random data for demo purposes
        function generateRandomData(count, min, max) {
            return Array.from({ length: count }, () => Math.floor(Math.random() * (max - min + 1)) + min);
        }
        
        // Update charts with new random data
        function updateChartsWithNewData() {
            // Update Sales Trend Chart
            window.salesTrendChart.data.datasets[0].data = generateRandomData(6, 300, 500);
            window.salesTrendChart.data.datasets[1].data = window.salesTrendChart.data.datasets[0].data.map(
                sale => sale * (Math.random() * 5 + 30)
            );
            window.salesTrendChart.update();
            
            // Update Category Pie Chart
            window.categoryPieChart.data.datasets[0].data = [
                Math.floor(Math.random() * 30) + 10,
                Math.floor(Math.random() * 30) + 10,
                Math.floor(Math.random() * 30) + 10,
                Math.floor(Math.random() * 30) + 10,
                Math.floor(Math.random() * 30) + 10
            ];
            window.categoryPieChart.update();
            
            // Update Inventory Chart
            for (let i = 0; i < 3; i++) {
                window.inventoryChart.data.datasets[i].data = generateRandomData(5, 10, 70);
            }
            window.inventoryChart.update();
            
            // Update stats cards
            updateStatsCards();
        }
        
        // Update stats cards with new random data
        function updateStatsCards() {
            const totalSales = Math.floor(Math.random() * 1000) + 2000;
            const totalRevenue = Math.floor(Math.random() * 20000) + 70000;
            const avgOrderValue = (totalRevenue / totalSales).toFixed(2);
            const unitsSold = Math.floor(Math.random() * 2000) + 4000;
            
            document.querySelector('.stat-card:nth-child(1) .stat-value').textContent = totalSales.toLocaleString();
            document.querySelector('.stat-card:nth-child(2) .stat-value').textContent = '$' + totalRevenue.toLocaleString();
            document.querySelector('.stat-card:nth-child(3) .stat-value').textContent = '$' + avgOrderValue;
            document.querySelector('.stat-card:nth-child(4) .stat-value').textContent = unitsSold.toLocaleString();
            
            // Update change percentages
            const changes = document.querySelectorAll('.stat-change');
            changes.forEach(change => {
                const isPositive = Math.random() > 0.3; // 70% chance of positive change
                const changePercent = (Math.random() * 15).toFixed(1);
                
                change.className = isPositive ? 'stat-change positive-change' : 'stat-change negative-change';
                change.innerHTML = `
                    <i class="fas fa-arrow-${isPositive ? 'up' : 'down'}"></i>
                    <span>${changePercent}% vs. previous period</span>
                `;
            });
        }
        
        // Update chart themes when changing between light/dark mode
        function updateChartsTheme() {
            const textColor = getComputedStyle(document.body).getPropertyValue('--text-color');
            
            [window.salesTrendChart, window.categoryPieChart, window.inventoryChart].forEach(chart => {
                if (chart.options.scales && chart.options.scales.x) {
                    chart.options.scales.x.ticks.color = textColor;
                }
                if (chart.options.scales && chart.options.scales.y) {
                    chart.options.scales.y.ticks.color = textColor;
                }
                if (chart.options.plugins && chart.options.plugins.legend && chart.options.plugins.legend.labels) {
                    chart.options.plugins.legend.labels.color = textColor;
                }
                chart.update();
            });
        }
        
        // Setup dropdown interactions
        function setupDropdowns() {
            // Sales Trend Chart Period Selection
            const salesTrendPeriods = document.querySelectorAll('.chart-card:nth-child(1) .dropdown-item');
            salesTrendPeriods.forEach(item => {
                item.addEventListener('click', function() {
                    const period = this.getAttribute('data-period');
                    const periodText = this.textContent;
                    this.closest('.dropdown').querySelector('.dropdown-button span').textContent = periodText;
                    
                    // Update chart based on selected period
                    let labels;
                    switch (period) {
                        case 'daily':
                            labels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
                            break;
                        case 'weekly':
                            labels = ['Week 1', 'Week 2', 'Week 3', 'Week 4'];
                            break;
                        case 'monthly':
                        default:
                            labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];
                            break;
                    }
                    
                    window.salesTrendChart.data.labels = labels;
                    window.salesTrendChart.data.datasets[0].data = generateRandomData(labels.length, 300, 500);
                    window.salesTrendChart.data.datasets[1].data = window.salesTrendChart.data.datasets[0].data.map(
                        sale => sale * (Math.random() * 5 + 30)
                    );
                    window.salesTrendChart.update();
                });
            });
            
            // Category Distribution Metric Selection
            const categoryMetrics = document.querySelectorAll('.chart-card:nth-child(2) .dropdown-item');
            categoryMetrics.forEach(item => {
                item.addEventListener('click', function() {
                    const metric = this.getAttribute('data-metric');
                    const metricText = this.textContent;
                    this.closest('.dropdown').querySelector('.dropdown-button span').textContent = metricText;
                    
                    // Update chart based on selected metric
                    window.categoryPieChart.data.datasets[0].data = generateRandomData(5, 10, 30);
                    window.categoryPieChart.update();
                });
            });
            
            // Top Products Sort Selection
            const productSorts = document.querySelectorAll('.chart-card:nth-child(3) .dropdown-item');
            productSorts.forEach(item => {
                item.addEventListener('click', function() {
                    const sort = this.getAttribute('data-sort');
                    const sortText = this.textContent;
                    this.closest('.dropdown').querySelector('.dropdown-button span').textContent = sortText;
                    
                    // In a real app, you would fetch and sort top products here
                    // For demo, we'll just randomize the progress bars
                    const progressBars = document.querySelectorAll('.product-progress-bar');
                    progressBars.forEach(bar => {
                        const width = Math.floor(Math.random() * 50) + 40 + '%';
                        bar.style.width = width;
                    });
                });
            });
            
            // Inventory View Selection
            const inventoryViews = document.querySelectorAll('.chart-card:nth-child(4) .dropdown-item');
            inventoryViews.forEach(item => {
                item.addEventListener('click', function() {
                    const view = this.getAttribute('data-view');
                    const viewText = this.textContent;
                    this.closest('.dropdown').querySelector('.dropdown-button span').textContent = viewText;
                    
                    if (view === 'status') {
                        window.inventoryChart.data.labels = ['In Stock', 'Low Stock', 'Out of Stock'];
                        window.inventoryChart.data = {
                            labels: ['In Stock', 'Low Stock', 'Out of Stock'],
                            datasets: [{
                                label: 'Products',
                                data: [250, 120, 80],
                                backgroundColor: [
                                    'rgba(46, 204, 113, 0.8)',
                                    'rgba(241, 196, 15, 0.8)',
                                    'rgba(231, 76, 60, 0.8)'
                                ],
                                borderColor: [
                                    'rgba(46, 204, 113, 1)',
                                    'rgba(241, 196, 15, 1)',
                                    'rgba(231, 76, 60, 1)'
                                ],
                                borderWidth: 1
                            }]
                        };
                        window.inventoryChart.config.type = 'pie';
                        window.inventoryChart.update();
                    } else {
                        window.inventoryChart.data.labels = ['Puzzles', 'Action Figures', 'Dolls', 'Board Games', 'Educational'];
                        window.inventoryChart.data = {
                            labels: ['Puzzles', 'Action Figures', 'Dolls', 'Board Games', 'Educational'],
                            datasets: [{
                                label: 'In Stock',
                                data: generateRandomData(5, 10, 70),
                                backgroundColor: 'rgba(46, 204, 113, 0.8)',
                                borderColor: 'rgba(46, 204, 113, 1)',
                                borderWidth: 1
                            }, {
                                label: 'Low Stock',
                                data: generateRandomData(5, 10, 40),
                                backgroundColor: 'rgba(241, 196, 15, 0.8)',
                                borderColor: 'rgba(241, 196, 15, 1)',
                                borderWidth: 1
                            }, {
                                label: 'Out of Stock',
                                data: generateRandomData(5, 5, 30),
                                backgroundColor: 'rgba(231, 76, 60, 0.8)',
                                borderColor: 'rgba(231, 76, 60, 1)',
                                borderWidth: 1
                            }]
                        };
                        window.inventoryChart.config.type = 'bar';
                        window.inventoryChart.update();
                    }
                });
            });
        }
    </script>
</body>
{% endblock %}    